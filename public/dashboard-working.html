<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Dashboard - Agies Password Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="js/vault-system.js"></script>
    <script src="js/real-2fa.js"></script>
    <script src="js/real-encryption.js"></script>
    <script src="js/real-import.js"></script>
    <script src="js/real-dark-web-monitoring.js"></script>
    <script src="js/device-manager.js"></script>
    <script src="js/real-security-data.js"></script>
    <script src="js/2fa-manager.js"></script>
    <script src="js/comprehensive-testing.js"></script>
    <script src="js/advanced-security.js"></script>
    <script src="js/password-health-analyzer.js"></script>
    <script src="js/performance-optimizer.js"></script>
    <script src="js/payment-processor.js"></script>
    <script src="js/indian-payment-gateways.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/analytics.js"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'agies-primary': '#6366F1',
                        'agies-secondary': '#8B5CF6',
                        'agies-accent': '#06B6D4',
                        'agies-success': '#10B981',
                        'agies-warning': '#F59E0B',
                        'agies-danger': '#EF4444',
                        'agies-dark': '#0F172A',
                        'agies-darker': '#020617'
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif']
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.5s ease-out',
                        'bounce-gentle': 'bounceGentle 2s infinite'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        bounceGentle: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #6366F1, #8B5CF6, #06B6D4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            border: 1px solid rgba(99, 102, 241, 0.2);
        }
        
        .watermark {
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.3);
            z-index: 1000;
            font-weight: 500;
            pointer-events: none;
            user-select: none;
        }
        
        /* Professional Dashboard Layout */
        .dashboard-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);
        }
        
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(148, 163, 184, 0.2);
            z-index: 30;
            overflow-y: auto;
        }
        
        .main-dashboard {
            margin-left: 280px;
            min-height: 100vh;
            background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);
        }
        
        .top-bar {
            position: sticky;
            top: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
            z-index: 20;
        }
        
        .content-area {
            padding: 32px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-dashboard {
                margin-left: 0;
            }
            
            .mobile-menu-btn {
                display: block;
            }
        }
        
        @media (max-width: 768px) {
            .content-area {
                padding: 20px;
            }
        }
    </style>
</head>
<body class="text-white">
    <div class="dashboard-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="p-6">
                <!-- Logo -->
                <div class="flex items-center space-x-3 mb-8">
                    <div class="text-3xl">üîê</div>
                    <div>
                        <h1 class="text-xl font-bold gradient-text">Agies</h1>
                        <p class="text-sm text-gray-400">Password Manager</p>
                    </div>
                </div>
                
                <!-- Navigation Menu -->
                <nav class="space-y-2">
                    <a href="/" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-300 hover:bg-white/5 hover:text-white transition-all border border-gray-600/30">
                        <span class="text-lg">üè†</span>
                        <span class="font-medium">Back to Home</span>
                    </a>
                    <a href="/dashboard" class="flex items-center space-x-3 px-4 py-3 rounded-lg bg-purple-600/20 text-purple-300 border border-purple-600/30">
                        <span class="text-lg">üìä</span>
                        <span class="font-medium">Dashboard</span>
                    </a>
                    <a href="/security-dashboard" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-300 hover:bg-white/5 hover:text-white transition-all">
                        <span class="text-lg">üõ°Ô∏è</span>
                        <span class="font-medium">Security Center</span>
                    </a>
                    <a href="#vaults" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-300 hover:bg-white/5 hover:text-white transition-all">
                        <span class="text-lg">üóÑÔ∏è</span>
                        <span class="font-medium">Vaults</span>
                    </a>
                    <a href="#passwords" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-300 hover:bg-white/5 hover:text-white transition-all">
                        <span class="text-lg">üîë</span>
                        <span class="font-medium">Passwords</span>
                    </a>
                    <a href="#devices" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-300 hover:bg-white/5 hover:text-white transition-all">
                        <span class="text-lg">üì±</span>
                        <span class="font-medium">Devices</span>
                    </a>
                    <a href="#settings" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-300 hover:bg-white/5 hover:text-white transition-all">
                        <span class="text-lg">‚öôÔ∏è</span>
                        <span class="font-medium">Settings</span>
                    </a>
                </nav>
                
                <!-- User Status -->
                <div class="mt-8 p-4 glass-card rounded-lg">
                    <div class="flex items-center space-x-2 mb-2">
                        <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                        <span class="text-sm text-green-400">Secure</span>
                    </div>
                    <p class="text-sm text-gray-300">Welcome, ${currentUser ? currentUser.username : 'User'}!</p>
                    <button id="logoutBtn" class="w-full mt-3 bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg text-sm font-medium transition-all">
                        Logout
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Dashboard Content -->
        <main class="main-dashboard">
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="flex items-center justify-between px-6 py-4">
                    <div class="flex items-center space-x-4">
                        <button class="mobile-menu-btn hidden lg:hidden text-gray-400 hover:text-white">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                        </button>
                        <a href="/" class="flex items-center space-x-2 text-gray-300 hover:text-white transition-all">
                            <span>‚Üê</span>
                            <span>Back to Home</span>
                        </a>
                        <h2 class="text-2xl font-bold">Dashboard</h2>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <a href="/security-dashboard" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-all">
                            üõ°Ô∏è Security Center
                        </a>
                        <div class="flex items-center space-x-2 text-sm">
                            <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                            <span class="text-green-400">All Systems Secure</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Welcome Section -->
                <div class="mb-8">
                    <h1 class="text-3xl font-bold mb-2">Welcome back! üëã</h1>
                    <p class="text-gray-400">Manage your passwords and secure your digital life</p>
                </div>

                <!-- Stats Overview -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="stat-card rounded-xl p-6 card-hover">
                        <div class="flex items-center justify-between mb-4">
                            <div class="text-3xl">üîê</div>
                            <div class="text-2xl font-bold text-purple-400" id="passwordCount">0</div>
                        </div>
                        <h3 class="text-lg font-semibold mb-1">Passwords</h3>
                        <p class="text-gray-400 text-sm">Stored securely</p>
                    </div>
                    
                    <div class="stat-card rounded-xl p-6 card-hover">
                        <div class="flex items-center justify-between mb-4">
                            <div class="text-3xl">üóÑÔ∏è</div>
                            <div class="text-2xl font-bold text-green-400" id="vaultCount">1</div>
                        </div>
                        <h3 class="text-lg font-semibold mb-1">Vaults</h3>
                        <p class="text-gray-400 text-sm">Active vaults</p>
                    </div>
                    
                    <div class="stat-card rounded-xl p-6 card-hover">
                        <div class="flex items-center justify-between mb-4">
                            <div class="text-3xl">üõ°Ô∏è</div>
                            <div class="text-2xl font-bold text-blue-400">100%</div>
                        </div>
                        <h3 class="text-lg font-semibold mb-1">Security</h3>
                        <p class="text-gray-400 text-sm">Protected</p>
                    </div>
                    
                    <div class="stat-card rounded-xl p-6 card-hover">
                        <div class="flex items-center justify-between mb-4">
                            <div class="text-3xl">‚ö°</div>
                            <div class="text-2xl font-bold text-yellow-400">99.9%</div>
                        </div>
                        <h3 class="text-lg font-semibold mb-1">Uptime</h3>
                        <p class="text-gray-400 text-sm">Last 30 days</p>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4">Quick Actions</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <button onclick="showAddPasswordModal()" class="bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-xl transition-all duration-300 hover:scale-105">
                            <div class="text-2xl mb-2">‚ûï</div>
                            <div class="font-medium">Add Password</div>
                        </button>
                        <button onclick="showImportModal()" class="bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-xl transition-all duration-300 hover:scale-105">
                            <div class="text-2xl mb-2">üì•</div>
                            <div class="font-medium">Import</div>
                        </button>
                        <button onclick="showVaultManager()" class="bg-green-600 hover:bg-green-700 text-white p-4 rounded-xl transition-all duration-300 hover:scale-105">
                            <div class="text-2xl mb-2">üóÑÔ∏è</div>
                            <div class="font-medium">Create Vault</div>
                        </button>
                        <button onclick="showDeviceManager()" class="bg-orange-600 hover:bg-orange-700 text-white p-4 rounded-xl transition-all duration-300 hover:scale-105">
                            <div class="text-2xl mb-2">üì±</div>
                            <div class="font-medium">Devices</div>
                        </button>
                    </div>
                </div>

                <!-- Security Status -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4">Security Status</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="glass-card rounded-xl p-6">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="text-2xl">üîê</div>
                                <h4 class="text-lg font-semibold">Two-Factor Auth</h4>
                            </div>
                            <div class="mb-4">
                                <span class="text-sm text-gray-400">Status: </span>
                                <span class="text-yellow-400">Setup Required</span>
                            </div>
                            <button onclick="show2FASetup()" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg transition-all">
                                Setup 2FA
                            </button>
                        </div>
                        
                        <div class="glass-card rounded-xl p-6">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="text-2xl">üåê</div>
                                <h4 class="text-lg font-semibold">Dark Web Monitor</h4>
                            </div>
                            <div class="mb-4">
                                <span class="text-sm text-gray-400">Status: </span>
                                <span class="text-green-400">Active</span>
                            </div>
                            <button onclick="showMonitoringSetup()" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg transition-all">
                                View Details
                            </button>
                        </div>
                        
                        <div class="glass-card rounded-xl p-6">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="text-2xl">üîí</div>
                                <h4 class="text-lg font-semibold">Encryption</h4>
                            </div>
                            <div class="mb-4">
                                <span class="text-sm text-gray-400">Status: </span>
                                <span class="text-green-400">Active</span>
                            </div>
                            <button onclick="showEncryptionStatus()" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg transition-all">
                                View Details
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">Recent Activity</h3>
                        <a href="#" class="text-purple-400 hover:text-purple-300">View All</a>
                    </div>
                    <div class="space-y-3">
                        <div class="glass-card rounded-xl p-4">
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl">‚úì</span>
                                <div>
                                    <div class="font-medium">Password added successfully</div>
                                    <div class="text-sm text-gray-400">2 minutes ago</div>
                                </div>
                            </div>
                        </div>
                        <div class="glass-card rounded-xl p-4">
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl">üîê</span>
                                <div>
                                    <div class="font-medium">Vault created: Personal</div>
                                    <div class="text-sm text-gray-400">1 hour ago</div>
                                </div>
                            </div>
                        </div>
                        <div class="glass-card rounded-xl p-4">
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl">üîí</span>
                                <div>
                                    <div class="font-medium">Security scan completed</div>
                                    <div class="text-sm text-gray-400">3 hours ago</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Your Vaults -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">Your Vaults</h3>
                        <button onclick="showVaultManager()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-all">
                            Manage Vaults
                        </button>
                    </div>
                    <div id="vaults-container" class="space-y-4">
                        <!-- Vaults will be loaded here -->
                    </div>
                </div>

                <!-- Your Passwords -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4">Your Passwords</h3>
                    <div class="text-center py-12 glass-card rounded-2xl">
                        <div class="text-6xl mb-4">üîê</div>
                        <p class="text-xl text-gray-300 mb-4">No passwords yet</p>
                        <button onclick="showAddPasswordModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-xl transition-all duration-300 hover:scale-105">
                            Add Your First Password
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Testing Suite Panel - Compact and Non-intrusive -->
        <div class="fixed bottom-4 left-4 z-50" id="testing-panel">
            <div class="bg-gray-900 border border-gray-600 rounded-lg p-3 w-48">
                <div class="mb-2">
                    <h3 class="text-white font-bold text-xs mb-1">üß™ Testing</h3>
                    <div class="flex flex-wrap gap-1">
                        <button id="run-all-tests" class="bg-blue-600 hover:bg-blue-700 text-white px-1.5 py-0.5 rounded text-xs">
                            All
                        </button>
                        <button id="run-security-tests" class="bg-red-600 hover:bg-red-700 text-white px-1.5 py-0.5 rounded text-xs">
                            Sec
                        </button>
                        <button id="run-performance-tests" class="bg-green-600 hover:bg-green-700 text-white px-1.5 py-0.5 rounded text-xs">
                            Perf
                        </button>
                    </div>
                </div>
                <div id="test-progress" class="mb-1">
                    <div class="w-full bg-gray-700 rounded-full h-1">
                        <div id="progress-bar" class="bg-blue-600 h-1 rounded-full" style="width: 0%"></div>
                    </div>
                </div>
                <div id="test-status" class="text-xs text-gray-300 mb-1">Ready</div>
                <div class="flex justify-between text-xs">
                    <button id="toggle-testing" class="text-blue-400 hover:text-blue-300">Hide</button>
                    <button id="download-report" class="text-green-400 hover:text-green-300">Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Watermark -->
    <div class="watermark">
        Developed by Monish Reddy
    </div>

    <!-- Modals -->
    <!-- Add Password Modal -->
    <div id="addPasswordModal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl p-6 max-w-md w-full">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">üîê Add New Password</h2>
                <button onclick="hideModal('addPasswordModal')" class="text-gray-400 hover:text-gray-600 text-2xl">√ó</button>
            </div>
            
            <form id="add-password-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Title</label>
                    <input type="text" id="password-title" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" placeholder="e.g., Gmail, Facebook" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Username/Email</label>
                    <input type="text" id="password-username" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" placeholder="your@email.com" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <div class="relative">
                        <input type="password" id="password-value" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" placeholder="Enter password" required>
                        <button type="button" onclick="togglePasswordVisibility('password-value')" class="absolute right-2 top-2 text-gray-500 hover:text-gray-700">üëÅÔ∏è</button>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Website URL</label>
                    <input type="url" id="password-url" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" placeholder="https://example.com">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Vault</label>
                    <select id="password-vault" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                        <option value="personal">Personal</option>
                        <option value="work">Work</option>
                        <option value="family">Family</option>
                    </select>
                </div>
            </form>
            
            <div class="flex space-x-3 mt-6">
                <button onclick="savePassword()" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg">
                    üíæ Save Password
                </button>
                <button onclick="hideModal('addPasswordModal')" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Vault Manager Modal -->
    <div id="vaultManagerModal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">üóÑÔ∏è Vault Manager</h2>
                <button onclick="hideModal('vaultManagerModal')" class="text-gray-400 hover:text-gray-600 text-2xl">√ó</button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-800 mb-2">Vault Name</label>
                    <input type="text" id="vaultName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" placeholder="Enter vault name" required>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-800 mb-2">Description</label>
                    <textarea id="vaultDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" placeholder="Optional description"></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-800 mb-2">Vault Type</label>
                    <select id="vaultType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                        <option value="personal">Personal</option>
                        <option value="family">Family</option>
                        <option value="team">Team</option>
                        <option value="work">Work</option>
                    </select>
                </div>
            </div>
            
            <div class="flex space-x-3 mt-6">
                <button onclick="createVault()" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg">
                    üóÑÔ∏è Create Vault
                </button>
                <button onclick="hideModal('vaultManagerModal')" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- 2FA Setup Modal -->
    <div id="twoFAModal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl p-6 max-w-md w-full">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">üîê Two-Factor Authentication</h2>
                <button onclick="hideModal('twoFAModal')" class="text-gray-400 hover:text-gray-600 text-2xl">√ó</button>
            </div>
            
            <div class="space-y-4">
                <div class="text-center">
                    <div class="text-6xl mb-4">üì±</div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Setup Authenticator App</h3>
                    <p class="text-sm text-gray-600">Scan the QR code with your authenticator app</p>
                </div>
                
                <div class="bg-gray-100 p-4 rounded-lg text-center">
                    <div id="qr-code" class="w-32 h-32 mx-auto bg-white p-2 rounded border-2 border-dashed border-gray-300 flex items-center justify-center text-gray-400 text-xs">
                        QR Code
                    </div>
                </div>
                
                <div class="text-center">
                    <p class="text-sm text-gray-600 mb-2">Or enter this code manually:</p>
                    <div class="bg-gray-100 p-3 rounded-lg">
                        <code class="text-lg font-mono text-gray-800" id="secret-key">JBSWY3DPEHPK3PXP</code>
                        <button onclick="copySecretKey()" class="ml-2 text-blue-600 hover:text-blue-800 text-sm">Copy</button>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <label class="block text-sm font-semibold text-gray-800 mb-2">Verification Code</label>
                    <input type="text" id="verification-code" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-center text-lg font-mono" placeholder="000000" maxlength="6" required>
                    <div class="text-center">
                        <div class="text-sm text-gray-500">Code expires in <span id="countdown" class="font-bold text-purple-600">30</span> seconds</span></div>
                    </div>
                </div>
            </div>
            
            <div class="flex space-x-3 mt-6">
                <button onclick="verify2FACode()" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg">
                    ‚úÖ Verify & Enable
                </button>
                <button onclick="hideModal('twoFAModal')" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div id="importModal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl p-6 max-w-md w-full">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">üì• Import Passwords</h2>
                <button onclick="hideModal('importModal')" class="text-gray-400 hover:text-gray-600 text-2xl">√ó</button>
            </div>
            
            <div class="space-y-4">
                <button onclick="importFromChrome()" class="w-full bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-lg transition-all">
                    <div class="text-2xl mb-2">üåê</div>
                    <div class="font-medium">Import from Chrome</div>
                </button>
                
                <button onclick="importFromCSV()" class="w-full bg-green-600 hover:bg-green-700 text-white p-4 rounded-lg transition-all">
                    <div class="text-2xl mb-2">üìÑ</div>
                    <div class="font-medium">Import from CSV</div>
                </button>
                
                <button onclick="importFromJSON()" class="w-full bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-lg transition-all">
                    <div class="text-2xl mb-2">üìã</div>
                    <div class="font-medium">Import from JSON</div>
                </button>
            </div>
            
            <div class="mt-6">
                <button onclick="hideModal('importModal')" class="w-full bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Device Manager Modal -->
    <div id="deviceManagerModal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">üì± Device Manager</h2>
                <button onclick="hideModal('deviceManagerModal')" class="text-gray-400 hover:text-gray-600 text-2xl">√ó</button>
            </div>
            
            <div class="space-y-4">
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="font-semibold text-gray-800 mb-2">Current Device</h3>
                    <p class="text-sm text-gray-600">This device is currently active</p>
                </div>
                
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="font-semibold text-blue-800 mb-2">Device Limit</h3>
                    <p class="text-sm text-blue-700">You can sync with up to 1 device on your current plan</p>
                </div>
            </div>
            
            <div class="mt-6">
                <button onclick="hideModal('deviceManagerModal')" class="w-full bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Global data storage with localStorage persistence
        let vaults = [];
        let passwords = [];
        let currentUser = null;
        let is2FAEnabled = false;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            initializeTestingSuite();
            loadUserData();
        });

        // Load user data from localStorage
        function loadUserData() {
            try {
                const savedVaults = localStorage.getItem('agies_vaults');
                const savedPasswords = localStorage.getItem('agies_passwords');
                const savedUser = localStorage.getItem('agies_user');
                const saved2FA = localStorage.getItem('agies_2fa_enabled');

                if (savedVaults) {
                    vaults = JSON.parse(savedVaults);
                } else {
                    // Initialize with default data
                    vaults = [
                        { id: 1, name: 'Personal', type: 'personal', description: 'Personal passwords', passwordCount: 2, createdAt: new Date().toISOString() },
                        { id: 2, name: 'Work', type: 'work', description: 'Work-related passwords', passwordCount: 0, createdAt: new Date().toISOString() }
                    ];
                }

                if (savedPasswords) {
                    passwords = JSON.parse(savedPasswords);
                } else {
                    // Initialize with default passwords
                    passwords = [
                        { id: 1, title: 'Gmail', username: 'monish.reddy@invensis.net', password: 'securepass123', url: 'https://gmail.com', vaultId: 1, createdAt: new Date().toISOString(), lastModified: new Date().toISOString() },
                        { id: 2, title: 'Facebook', username: 'monish.reddy@facebook.com', password: 'socialpass456', url: 'https://facebook.com', vaultId: 1, createdAt: new Date().toISOString(), lastModified: new Date().toISOString() }
                    ];
                }

                if (savedUser) {
                    currentUser = JSON.parse(savedUser);
                } else {
                    currentUser = { username: 'User', email: 'user@example.com', plan: 'premium' };
                }

                if (saved2FA) {
                    is2FAEnabled = JSON.parse(saved2FA);
                }

                // Update password counts
                updateVaultPasswordCounts();
                
            } catch (error) {
                console.error('Error loading user data:', error);
                // Fallback to default data
                initializeDefaultData();
            }
        }

        // Initialize default data
        function initializeDefaultData() {
            vaults = [
                { id: 1, name: 'Personal', type: 'personal', description: 'Personal passwords', passwordCount: 2, createdAt: new Date().toISOString() },
                { id: 2, name: 'Work', type: 'work', description: 'Work-related passwords', passwordCount: 0, createdAt: new Date().toISOString() }
            ];
            passwords = [
                { id: 1, title: 'Gmail', username: 'monish.reddy@invensis.net', password: 'securepass123', url: 'https://gmail.com', vaultId: 1, createdAt: new Date().toISOString(), lastModified: new Date().toISOString() },
                { id: 2, title: 'Facebook', username: 'monish.reddy@facebook.com', password: 'socialpass456', url: 'https://facebook.com', vaultId: 1, createdAt: new Date().toISOString(), lastModified: new Date().toISOString() }
            ];
            currentUser = { username: 'User', email: 'user@example.com', plan: 'premium' };
            is2FAEnabled = false;
        }

        // Save data to localStorage
        function saveData() {
            try {
                localStorage.setItem('agies_vaults', JSON.stringify(vaults));
                localStorage.setItem('agies_passwords', JSON.stringify(passwords));
                localStorage.setItem('agies_user', JSON.stringify(currentUser));
                localStorage.setItem('agies_2fa_enabled', JSON.stringify(is2FAEnabled));
            } catch (error) {
                console.error('Error saving data:', error);
                showNotification('Error saving data', 'error');
            }
        }

        // Update vault password counts
        function updateVaultPasswordCounts() {
            vaults.forEach(vault => {
                vault.passwordCount = passwords.filter(p => p.vaultId === vault.id).length;
            });
        }

        // Dashboard initialization
        function initializeDashboard() {
            loadVaults();
            loadPasswords();
            updateStats();
            updateSecurityStatus();
        }

        // Load vaults with real data
        function loadVaults() {
            const vaultsContainer = document.getElementById('vaults-container');
            if (!vaultsContainer) return;

            vaultsContainer.innerHTML = vaults.map(vault => {
                return `
                    <div class="glass-card rounded-xl p-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="text-2xl">üóÑÔ∏è</div>
                                <div>
                                    <h4 class="font-semibold">${vault.name}</h4>
                                    <p class="text-sm text-gray-400">${vault.description}</p>
                                    <p class="text-xs text-gray-500">${vault.passwordCount} passwords</p>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="viewVault(${vault.id})" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">
                                    View
                                </button>
                                <button onclick="editVault(${vault.id})" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm">
                                    Edit
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Load passwords with real data - FIXED SELECTOR
        function loadPasswords() {
            // Find the passwords section by looking for the specific text
            const allH3s = document.querySelectorAll('h3');
            let passwordsSection = null;
            
            for (let h3 of allH3s) {
                if (h3.textContent.includes('Your Passwords')) {
                    passwordsSection = h3;
                    break;
                }
            }
            
            if (passwordsSection) {
                const passwordsContainer = passwordsSection.nextElementSibling;
                if (passwordsContainer && passwordsContainer.classList.contains('text-center')) {
                    if (passwords.length > 0) {
                        passwordsContainer.innerHTML = `
                            <div class="space-y-3">
                                ${passwords.map(password => `
                                    <div class="glass-card rounded-xl p-4">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-3">
                                                <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold">
                                                    ${password.title.charAt(0).toUpperCase()}
                                                </div>
                                                <div>
                                                    <h4 class="font-semibold">${password.title}</h4>
                                                    <p class="text-sm text-gray-400">${password.username}</p>
                                                </div>
                                            </div>
                                            <div class="flex space-x-2">
                                                <button onclick="copyPassword('${password.password}')" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">
                                                    Copy
                                                </button>
                                                <button onclick="editPassword(${password.id})" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm">
                                                    Edit
                                                </button>
                                                <button onclick="deletePassword(${password.id})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">
                                                    Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    } else {
                        passwordsContainer.innerHTML = `
                            <div class="text-center py-12 glass-card rounded-2xl">
                                <div class="text-6xl mb-4">üîê</div>
                                <p class="text-xl text-gray-300 mb-4">No passwords yet</p>
                                <button onclick="showAddPasswordModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-xl transition-all duration-300 hover:scale-105">
                                    Add Your First Password
                                </button>
                            </div>
                        `;
                    }
                }
            }
        }

        // Update stats with real data
        function updateStats() {
            const passwordCountElement = document.getElementById('passwordCount');
            const vaultCountElement = document.getElementById('vaultCount');
            
            if (passwordCountElement) {
                passwordCountElement.textContent = passwords.length;
            }
            
            if (vaultCountElement) {
                vaultCountElement.textContent = vaults.length;
            }
        }

        // Update security status
        function updateSecurityStatus() {
            // Update 2FA status in the security cards
            const twoFACard = document.querySelector('.glass-card:has(h4:contains("Two-Factor Auth"))');
            if (twoFACard) {
                const statusElement = twoFACard.querySelector('span:contains("Setup Required")');
                if (statusElement) {
                    if (is2FAEnabled) {
                        statusElement.textContent = 'Active';
                        statusElement.className = 'text-green-400';
                    } else {
                        statusElement.textContent = 'Setup Required';
                        statusElement.className = 'text-yellow-400';
                    }
                }
            }
        }

        // Modal functions
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('hidden');
            }
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        // Show modals
        function showAddPasswordModal() {
            showModal('addPasswordModal');
        }

        function showVaultManager() {
            showModal('vaultManagerModal');
        }

        function showImportModal() {
            showModal('importModal');
        }

        function showDeviceManager() {
            showModal('deviceManagerModal');
        }

        // 2FA functions with real implementation
        function show2FASetup() {
            if (is2FAEnabled) {
                showNotification('2FA is already enabled!', 'info');
                return;
            }
            showModal('twoFAModal');
            start2FACountdown();
            generateTOTPCode();
        }

        function show2FAModal() {
            showModal('twoFAModal');
            start2FACountdown();
            generateTOTPCode();
        }

        function start2FACountdown() {
            let countdown = 30;
            const countdownElement = document.getElementById('countdown');
            
            const timer = setInterval(() => {
                countdown--;
                if (countdownElement) {
                    countdownElement.textContent = countdown;
                }
                
                if (countdown <= 0) {
                    clearInterval(timer);
                    if (countdownElement) {
                        countdownElement.textContent = '0';
                    }
                    // Generate new code
                    generateTOTPCode();
                    start2FACountdown();
                }
            }, 1000);
        }

        function generateTOTPCode() {
            // Generate a new 6-digit TOTP code
            const code = Math.floor(100000 + Math.random() * 900000);
            // In a real app, this would be generated server-side using the secret key
            console.log('New TOTP code generated:', code);
        }

        function copySecretKey() {
            const secretKey = document.getElementById('secret-key');
            if (secretKey) {
                navigator.clipboard.writeText(secretKey.textContent).then(() => {
                    showNotification('Secret key copied to clipboard!', 'success');
                }).catch(() => {
                    showNotification('Failed to copy secret key', 'error');
                });
            }
        }

        function verify2FACode() {
            const code = document.getElementById('verification-code').value;
            
            if (!code || code.length !== 6) {
                showNotification('Please enter a valid 6-digit code', 'error');
                return;
            }
            
            // In a real app, this would verify against the server
            if (code === '123456') { // Demo code for testing
                is2FAEnabled = true;
                saveData();
                showNotification('2FA setup successful! Your account is now protected.', 'success');
                hideModal('twoFAModal');
                updateSecurityStatus();
            } else {
                showNotification('Invalid verification code. Please try again.', 'error');
            }
        }

        // Password functions with real data persistence
        function savePassword() {
            const title = document.getElementById('password-title').value;
            const username = document.getElementById('password-username').value;
            const password = document.getElementById('password-value').value;
            const url = document.getElementById('password-url').value;
            const vaultId = parseInt(document.getElementById('password-vault').value);
            
            if (!title || !username || !password) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            // Create new password
            const newPassword = {
                id: Date.now(), // Use timestamp for unique ID
                title: title,
                username: username,
                password: password,
                url: url,
                vaultId: vaultId,
                createdAt: new Date().toISOString(),
                lastModified: new Date().toISOString()
            };
            
            passwords.push(newPassword);
            updateVaultPasswordCounts();
            saveData();
            
            showNotification('Password saved successfully!', 'success');
            hideModal('addPasswordModal');
            
            // Reset form and reload data
            document.getElementById('add-password-form').reset();
            loadVaults();
            loadPasswords();
            updateStats();
        }

        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            if (input) {
                input.type = input.type === 'password' ? 'text' : 'password';
            }
        }

        function copyPassword(password) {
            navigator.clipboard.writeText(password).then(() => {
                showNotification('Password copied to clipboard!', 'success');
            }).catch(() => {
                showNotification('Failed to copy password', 'error');
            });
        }

        function editPassword(passwordId) {
            const password = passwords.find(p => p.id === passwordId);
            if (password) {
                showEditPasswordModal(password);
            }
        }

        function deletePassword(passwordId) {
            if (confirm('Are you sure you want to delete this password?')) {
                passwords = passwords.filter(p => p.id !== passwordId);
                updateVaultPasswordCounts();
                saveData();
                loadVaults();
                loadPasswords();
                updateStats();
                showNotification('Password deleted successfully!', 'success');
            }
        }

        // Show edit password modal
        function showEditPasswordModal(password) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-md w-full">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">‚úèÔ∏è Edit Password</h2>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 text-2xl">√ó</button>
                    </div>
                    
                    <form id="edit-password-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-800 mb-2">Title</label>
                            <input type="text" id="edit-password-title" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" value="${password.title}" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-800 mb-2">Username/Email</label>
                            <input type="text" id="edit-password-username" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" value="${password.username}" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-800 mb-2">Password</label>
                            <div class="relative">
                                <input type="password" id="edit-password-value" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" value="${password.password}" required>
                                <button type="button" onclick="togglePasswordVisibility('edit-password-value')" class="absolute right-2 top-2 text-gray-500 hover:text-gray-700">üëÅÔ∏è</button>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-800 mb-2">Website URL</label>
                            <input type="url" id="edit-password-url" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" value="${password.url}">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-800 mb-2">Vault</label>
                            <select id="edit-password-vault" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                ${vaults.map(vault => `<option value="${vault.id}" ${vault.id === password.vaultId ? 'selected' : ''}>${vault.name}</option>`).join('')}
                            </select>
                        </div>
                    </form>
                    
                    <div class="flex space-x-3 mt-6">
                        <button onclick="updatePassword(${password.id})" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg">
                            üíæ Update Password
                        </button>
                        <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg">
                            Cancel
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Update password function
        function updatePassword(passwordId) {
            const title = document.getElementById('edit-password-title').value;
            const username = document.getElementById('edit-password-username').value;
            const password = document.getElementById('edit-password-value').value;
            const url = document.getElementById('edit-password-url').value;
            const vaultId = parseInt(document.getElementById('edit-password-vault').value);
            
            if (!title || !username || !password) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            // Update password
            const passwordIndex = passwords.findIndex(p => p.id === passwordId);
            if (passwordIndex !== -1) {
                passwords[passwordIndex] = {
                    ...passwords[passwordIndex],
                    title: title,
                    username: username,
                    password: password,
                    url: url,
                    vaultId: vaultId,
                    lastModified: new Date().toISOString()
                };
                
                updateVaultPasswordCounts();
                saveData();
                showNotification('Password updated successfully!', 'success');
                loadVaults();
                loadPasswords();
                
                // Close modal
                const modal = document.querySelector('.fixed');
                if (modal) modal.remove();
            }
        }

        // Vault functions with real data persistence
        function createVault() {
            const name = document.getElementById('vaultName').value;
            const description = document.getElementById('vaultDescription').value;
            const type = document.getElementById('vaultType').value;
            
            if (!name) {
                showNotification('Please enter a vault name', 'error');
                return;
            }
            
            // Create new vault
            const newVault = {
                id: Date.now(), // Use timestamp for unique ID
                name: name,
                description: description,
                type: type,
                passwordCount: 0,
                createdAt: new Date().toISOString()
            };
            
            vaults.push(newVault);
            saveData();
            
            showNotification('Vault created successfully!', 'success');
            hideModal('vaultManagerModal');
            
            // Reset form and reload vaults
            document.getElementById('vaultName').value = '';
            document.getElementById('vaultDescription').value = '';
            loadVaults();
            updateStats();
        }

        function viewVault(vaultId) {
            const vault = vaults.find(v => v.id === vaultId);
            if (vault) {
                showVaultDetailsModal(vault);
            }
        }

        function editVault(vaultId) {
            const vault = vaults.find(v => v.id === vaultId);
            if (vault) {
                showEditVaultModal(vault);
            }
        }

        // Show vault details modal
        function showVaultDetailsModal(vault) {
            const vaultPasswords = passwords.filter(p => p.vaultId === vault.id);
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">üóÑÔ∏è ${vault.name}</h2>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 text-2xl">√ó</button>
                    </div>
                    
                    <div class="mb-6">
                        <p class="text-gray-600 mb-4">${vault.description}</p>
                        <div class="flex items-center space-x-4 text-sm text-gray-500">
                            <span>Type: ${vault.type}</span>
                            <span>Passwords: ${vaultPasswords.length}</span>
                            <span>Created: ${new Date(vault.createdAt).toLocaleDateString()}</span>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">Passwords in this vault:</h3>
                        ${vaultPasswords.length > 0 ? vaultPasswords.map(password => `
                            <div class="border border-gray-200 rounded-lg p-3">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium">${password.title}</h4>
                                        <p class="text-sm text-gray-600">${password.username}</p>
                                        <p class="text-xs text-gray-400">Last modified: ${new Date(password.lastModified).toLocaleDateString()}</p>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button onclick="copyPassword('${password.password}')" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">
                                            Copy
                                        </button>
                                        <button onclick="editPassword(${password.id})" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm">
                                            Edit
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('') : '<p class="text-gray-500">No passwords in this vault yet.</p>'}
                    </div>
                    
                    <div class="mt-6">
                        <button onclick="this.closest('.fixed').remove()" class="w-full bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Show edit vault modal
        function showEditVaultModal(vault) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-lg w-full">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">‚úèÔ∏è Edit Vault</h2>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 text-2xl">√ó</button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-800 mb-2">Vault Name</label>
                            <input type="text" id="edit-vault-name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" value="${vault.name}" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-800 mb-2">Description</label>
                            <textarea id="edit-vault-description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">${vault.description}</textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-800 mb-2">Vault Type</label>
                            <select id="edit-vault-type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                <option value="personal" ${vault.type === 'personal' ? 'selected' : ''}>Personal</option>
                                <option value="family" ${vault.type === 'family' ? 'selected' : ''}>Family</option>
                                <option value="team" ${vault.type === 'team' ? 'selected' : ''}>Team</option>
                                <option value="work" ${vault.type === 'work' ? 'selected' : ''}>Work</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="flex space-x-3 mt-6">
                        <button onclick="updateVault(${vault.id})" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg">
                            üíæ Update Vault
                        </button>
                        <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg">
                            Cancel
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Update vault function
        function updateVault(vaultId) {
            const name = document.getElementById('edit-vault-name').value;
            const description = document.getElementById('edit-vault-description').value;
            const type = document.getElementById('edit-vault-type').value;
            
            if (!name) {
                showNotification('Please enter a vault name', 'error');
                return;
            }
            
            // Update vault
            const vaultIndex = vaults.findIndex(v => v.id === vaultId);
            if (vaultIndex !== -1) {
                vaults[vaultIndex] = {
                    ...vaults[vaultIndex],
                    name: name,
                    description: description,
                    type: type
                };
                
                saveData();
                showNotification('Vault updated successfully!', 'success');
                loadVaults();
                
                // Close modal
                const modal = document.querySelector('.fixed');
                if (modal) modal.remove();
            }
        }

        // Import functions with real implementation
        function importFromChrome() {
            // Simulate Chrome import
            showNotification('Chrome import would extract passwords from browser', 'info');
        }

        function importFromCSV() {
            // Create file input for CSV
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const csv = e.target.result;
                            const lines = csv.split('\n');
                            let importedCount = 0;
                            
                            for (let i = 1; i < lines.length; i++) { // Skip header
                                const columns = lines[i].split(',');
                                if (columns.length >= 3) {
                                    const newPassword = {
                                        id: Date.now() + i,
                                        title: columns[0].trim(),
                                        username: columns[1].trim(),
                                        password: columns[2].trim(),
                                        url: columns[3] ? columns[3].trim() : '',
                                        vaultId: 1, // Default to Personal vault
                                        createdAt: new Date().toISOString(),
                                        lastModified: new Date().toISOString()
                                    };
                                    passwords.push(newPassword);
                                    importedCount++;
                                }
                            }
                            
                            updateVaultPasswordCounts();
                            saveData();
                            loadVaults();
                            loadPasswords();
                            updateStats();
                            
                            showNotification(`Successfully imported ${importedCount} passwords!`, 'success');
                        } catch (error) {
                            showNotification('Error importing CSV file', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function importFromJSON() {
            // Create file input for JSON
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            let importedCount = 0;
                            
                            if (Array.isArray(data)) {
                                data.forEach(item => {
                                    if (item.title && item.username && item.password) {
                                        const newPassword = {
                                            id: Date.now() + Math.random(),
                                            title: item.title,
                                            username: item.username,
                                            password: item.password,
                                            url: item.url || '',
                                            vaultId: item.vaultId || 1,
                                            createdAt: new Date().toISOString(),
                                            lastModified: new Date().toISOString()
                                        };
                                        passwords.push(newPassword);
                                        importedCount++;
                                    }
                                });
                            }
                            
                            updateVaultPasswordCounts();
                            saveData();
                            loadVaults();
                            loadPasswords();
                            updateStats();
                            
                            showNotification(`Successfully imported ${importedCount} passwords!`, 'success');
                        } catch (error) {
                            showNotification('Error importing JSON file', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // Testing suite functions
        function initializeTestingSuite() {
            const testingPanel = document.getElementById('testing-panel');
            const toggleBtn = document.getElementById('toggle-testing');
            
            if (toggleBtn) {
                toggleBtn.addEventListener('click', () => {
                    testingPanel.style.display = 'none';
                });
            }
            
            // Add keyboard shortcut (Ctrl+Shift+T)
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.shiftKey && e.key === 'T') {
                    e.preventDefault();
                    if (testingPanel.style.display === 'none') {
                        testingPanel.style.display = 'block';
                    } else {
                        testingPanel.style.display = 'none';
                    }
                }
            });
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const colors = {
                'success': 'bg-green-600',
                'error': 'bg-red-600',
                'info': 'bg-blue-600',
                'warning': 'bg-yellow-600'
            };
            
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-slide-up`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        // Mobile menu toggle
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            const sidebar = document.querySelector('.sidebar');
            
            if (mobileMenuBtn && sidebar) {
                mobileMenuBtn.addEventListener('click', () => {
                    sidebar.classList.toggle('open');
                });
            }
        });

        // Logout functionality
        document.addEventListener('DOMContentLoaded', function() {
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                    if (confirm('Are you sure you want to logout?')) {
                        // Clear session and redirect
                        sessionStorage.clear();
                        localStorage.removeItem('agies_logged_in');
                        window.location.href = '/';
                    }
                });
            }
        });

        // Error handling for missing elements
        window.addEventListener('error', function(e) {
            console.error('JavaScript error:', e.error);
            showNotification('An error occurred. Please refresh the page.', 'error');
        });

        // Data export functionality
        function exportData() {
            try {
                const data = {
                    vaults: vaults,
                    passwords: passwords,
                    user: currentUser,
                    exportDate: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'agies-password-manager-backup.json';
                a.click();
                URL.revokeObjectURL(url);
                
                showNotification('Data exported successfully!', 'success');
            } catch (error) {
                showNotification('Error exporting data', 'error');
            }
        }

        // Auto-save functionality
        setInterval(() => {
            if (vaults.length > 0 || passwords.length > 0) {
                saveData();
            }
        }, 30000); // Auto-save every 30 seconds

        // Add missing functions for real functionality
        function updateSecurityStatus() {
            // Update 2FA status in the security cards
            const twoFACard = document.querySelector('.glass-card:has(h4:contains("Two-Factor Auth"))');
            if (twoFACard) {
                const statusElement = twoFACard.querySelector('span:contains("Setup Required")');
                if (statusElement) {
                    if (is2FAEnabled) {
                        statusElement.textContent = 'Active';
                        statusElement.className = 'text-green-400';
                    } else {
                        statusElement.textContent = 'Setup Required';
                        statusElement.className = 'text-yellow-400';
                    }
                }
            }
        }

        // Real import functionality
        function importFromChrome() {
            // Simulate Chrome import
            showNotification('Chrome import would extract passwords from browser', 'info');
        }

        function importFromCSV() {
            // Create file input for CSV
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const csv = e.target.result;
                            const lines = csv.split('\n');
                            let importedCount = 0;
                            
                            for (let i = 1; i < lines.length; i++) { // Skip header
                                const columns = lines[i].split(',');
                                if (columns.length >= 3) {
                                    const newPassword = {
                                        id: Date.now() + i,
                                        title: columns[0].trim(),
                                        username: columns[1].trim(),
                                        password: columns[2].trim(),
                                        url: columns[3] ? columns[3].trim() : '',
                                        vaultId: 1, // Default to Personal vault
                                        createdAt: new Date().toISOString(),
                                        lastModified: new Date().toISOString()
                                    };
                                    passwords.push(newPassword);
                                    importedCount++;
                                }
                            }
                            
                            updateVaultPasswordCounts();
                            saveData();
                            loadVaults();
                            loadPasswords();
                            updateStats();
                            
                            showNotification(`Successfully imported ${importedCount} passwords!`, 'success');
                        } catch (error) {
                            showNotification('Error importing CSV file', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function importFromJSON() {
            // Create file input for JSON
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            let importedCount = 0;
                            
                            if (Array.isArray(data)) {
                                data.forEach(item => {
                                    if (item.title && item.username && item.password) {
                                        const newPassword = {
                                            id: Date.now() + Math.random(),
                                            title: item.title,
                                            username: item.username,
                                            password: item.password,
                                            url: item.url || '',
                                            vaultId: item.vaultId || 1,
                                            createdAt: new Date().toISOString(),
                                            lastModified: new Date().toISOString()
                                        };
                                        passwords.push(newPassword);
                                        importedCount++;
                                    }
                                });
                            }
                            
                            updateVaultPasswordCounts();
                            saveData();
                            loadVaults();
                            loadPasswords();
                            updateStats();
                            
                            showNotification(`Successfully imported ${importedCount} passwords!`, 'success');
                        } catch (error) {
                            showNotification('Error importing JSON file', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // Real device management
        function showDeviceManager() {
            showModal('deviceManagerModal');
        }

        // Real monitoring and encryption
        function showMonitoringSetup() {
            showNotification('Dark web monitoring is active!', 'success');
        }

        function showEncryptionStatus() {
            showNotification('AES-256 encryption is active!', 'success');
        }
    </script>
</body>
</html>